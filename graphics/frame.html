<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>PCCDiscord NodeCG bundle</title>
	<link
		rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
	/>
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
</head>
<body>
	<div id="top-band"></div>
	<div id="frame"></div>
	<div id="bottom-band"></div>
	<div id="bottom-band-right"></div>
	<div id="title" class="font-jp">
		<span class="icons-small material-icons">flag</span>
		<span id="title-text"></span>
	</div>
	<div id="pccdiscord" class="font">PCCDiscord</div>
	<div id="onair" class="font-jp">
		<span class="icons material-icons">sensors</span>
		<span id="onair-text"></span>
	</div>
	<div id="by" class="font-jp">
		<span class="icons material-icons">supervisor_account</span>	
		<span id="by-text"></span>
	</div>
	<div id="time" class="font-jp">
		<span class="icons material-icons">access_time</span>
		<span id="time-text"></span>
	</div>
	<div id="clock" class="font-jp"></div>
	<div id="bgm" class="font-jp">
		<span class="icons-small material-icons">queue_music</span>
		<span id="bgm-text"></span>
	</div>
	<div id="url" class="font-jp">
		<span class="icons-small material-icons">link</span>
		<div id="url-text"></div>
		</div>	
</body>
<script>
	const getJSON = function(url, callback) {
	    var xhr = new XMLHttpRequest();
	    xhr.open('GET', url, true);
	    xhr.responseType = 'json';
	    xhr.onload = function() {
	      var status = xhr.status;
	      if (status === 200) {
			callback(xhr.response);
	      } else {
			console.log("Error while GETting json, " + String(status));
			callback(null);
	      }
	    };
    	xhr.send();
	};
	nodecg.Replicant("title").on("change", newValue => {
	document.getElementById("title-text").innerText = newValue;
	});
	nodecg.Replicant("url").on("change", newValue => {
	document.getElementById("url-text").innerText = newValue;
	});
	nodecg.Replicant("bgm").on("change", newValue => {
		let text="Unknown";
		if(newValue != undefined) {
			text=newValue;
		}
		document.getElementById("bgm-text").innerText = text;
	});
	nodecg.Replicant("stream").on("change", newValue => {
		const onair = document.getElementById("onair-text");
		const by = document.getElementById("by-text");
		const time = document.getElementById("time-text");
		//onair.classList.add("onair-fadeout");
		let streamObj;
		setTimeout(() => {
			getJSON(newValue, (v) => {
				console.log(v);
				onair.innerText = v.title;
				by.innerText = v.author;
				time.innerText = v.time;
				//onair.classList.replace("onair-fadeout","onair-fadein");
			});
		}, 1000);
	});
	const chk = (i) => {
		const s = String(i)
		if (s.length === 1) {
			return "0" + s;
		} else {
			return s;
		}
	}
	const clock = () => {
		const time = new Date();
		document.getElementById("clock").innerText = chk(time.getHours()) + ":" + chk(time.getMinutes()) + ":" + chk(time.getSeconds());
	}
	setInterval(clock, 1000);
</script>
<style>
	body {
		margin: 0;
		background-color: #2C2F33;
		width: 1920px;
		height: 1080px;
		overflow: hidden;
	}
	#frame {
		border: 0;
		margin: 100px 320px;
		padding: 0;
		height: 720px;
		width: 1280px;
		background-color: green;
		position: absolute;
	}
	#top-band {
		height: 100px;
		width: 1920px;
		background-color: #23272A;
		position: absolute;
	}
	#bottom-band {
		height: 540px;
		width: 1920px;
		margin-top: 820px;
		background-color: #23272A;
		position: absolute;
	}
	#bottom-band-right {
		height: 540px;
		width: 800px;
		margin-top: 820px;
		margin-left: 1120px;
		background-color: #36393F;
		position: absolute;
	}
	#title {
		margin-top: 850px;
		margin-left: 50px;
		font-size: x-large;
	}
	#pccdiscord {
		margin-top: 30px;
		margin-left: 50px;
	}
	.font {
		position: absolute;
		color: white;
		font-family: 'Audiowide', cursive;
		font-size: xx-large;
		z-index: 10;
	}
	.font-jp {
		position: absolute;
		color: white;
		font-family: 'M PLUS Rounded 1c', sans-serif;
		font-size: xx-large;
		z-index: 10;
	}
	.icons {
		font-size: 40px;
		vertical-align: sub;
	}
	.icons-small {
		font-size: xx-large;
		vertical-align: sub;
	}
	#onair {
		margin-top: 900px;
		margin-left: 70px;	
	}
	#by {
		margin-top: 950px;
		margin-left: 70px;
		font-size: x-large;
	}
	#clock {
		margin-top: 30px;
		margin-right: 50px;
		width: 1870px;
		text-align: right;
	}
	#time {
		margin-top: 1000px;
		margin-left: 70px;
		font-size: x-large;
	}
	#bgm {
		margin-top: 860px;
		margin-left: 1170px;
		font-size: x-large;
	}
	#url {
		margin-top: 970px;
		margin-left: 1170px;
		font-size: x-large;
	}
</style>
</html>
